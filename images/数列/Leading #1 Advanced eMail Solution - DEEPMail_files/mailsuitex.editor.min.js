function DEEPEditor(){this.objHtmlDoc;this.objTextDoc;this.objSrcDoc;this.objHtmlDiv;this.objTextDiv;this.objSrcDiv;this.objToolBar;this.objEmptyBar;this.bodyHead;this.bodyTail;this.editorType;this.srcMode;this.selection;this.subMenu;this.bSetSubMenuPos;this.lang;this.msg;this.editorOption;this.MakeToolBar=function(){var I={fontlist:[{name:"Arial"},{name:"Tahoma"},{name:"Verdana"},{name:"System"},{name:"MS Gothic"},{name:"MS Mincho"},{name:"Courier New"},{name:"Times New Roman"}],fontsize:[{size:"1",css:"xx-small"},{size:"2",css:"x-small"},{size:"3",css:"small"},{size:"4",css:"medium"},{size:"5",css:"large"},{size:"6",css:"x-large"},{size:"7",css:"xx-large"}],color:[{color:"000000"},{color:"990000"},{color:"FF0000"},{color:"FF00FF"},{color:"FF99CC"},{color:"993300"},{color:"FF6600"},{color:"FF9900"},{color:"FF8400"},{color:"19CC6B"},{color:"333300"},{color:"999900"},{color:"99CC00"},{color:"FFFF00"},{color:"FFFF99"},{color:"022000"},{color:"099000"},{color:"339966"},{color:"00FF00"},{color:"CCFFCC"},{color:"003366"},{color:"009999"},{color:"33CCCC"},{color:"00FFFF"},{color:"CCFF25"},{color:"000099"},{color:"0000FF"},{color:"3366FF"},{color:"00CCFF"},{color:"99CCFF"},{color:"333399"},{color:"666699"},{color:"990990"},{color:"993366"},{color:"CC99FF"},{color:"333333"},{color:"808080"},{color:"999999"},{color:"CCCCCC"},{color:"FFFFFF"}]};var L={item:[{group:"fontlist",title:"Font",cmd:"fontlist",exec:false},{group:"fontsize",title:"Size",cmd:"fontsize",exec:false},{group:"fonttype",title:"Bold",cmd:"bold",exec:true},{group:"fonttype",title:"Italic",cmd:"italic",exec:true},{group:"fonttype",title:"Underline",cmd:"underline",exec:true},{group:"color",title:"ForeColor",cmd:"forecolor",exec:false},{group:"color",title:"BackColor",cmd:"backcolor",exec:false},{group:"link",title:"Hyperlink",cmd:"createlink",exec:false},{group:"list",title:"Numbered list",cmd:"insertorderedlist",exec:true},{group:"list",title:"Dotted list",cmd:"insertunorderedlist",exec:true},{group:"indent",title:"Add indentation",cmd:"indent",exec:true},{group:"indent",title:"Del indentation",cmd:"outdent",exec:true},{group:"align",title:"Left align",cmd:"justifyleft",exec:true},{group:"align",title:"Center align",cmd:"justifycenter",exec:true},{group:"align",title:"Right align",cmd:"justifyright",exec:true}]};var K=L.item;var F="";for(i=0;i<K.length;i++){var M=K[i]["group"];if(this.editorOption[M]==false){continue}if(K[i]["cmd"]=="fontlist"){F+='<div style="border-color:#ffffff" class="toolbar-group">'}else{if(K[i]["cmd"]=="fontsize"){F+='</div><div style="border-color:#ffffff" class="toolbar-group">'}else{if(K[i]["cmd"]=="bold"||K[i]["cmd"]=="forecolor"||K[i]["cmd"]=="createlink"||K[i]["cmd"]=="insertorderedlist"||K[i]["cmd"]=="indent"||K[i]["cmd"]=="justifyleft"){F+='</div><div class="toolbar-group">'}}}var J=(K[i]["cmd"].indexOf("font")==0)?49:20;F+='<span id="toolbar-'+K[i]["cmd"]+'" class="toolbar-item" onMouseOver="javascript:deepEditor.ToggleMenu(\''+K[i]["cmd"]+"',true);\" onMouseOut=\"javascript:deepEditor.ToggleMenu('"+K[i]["cmd"]+"',false);\">";F+='<img src="'+this.editorOption.path+'clear.gif" style="width:'+J+'px;height:20px;border:0px;" ';F+=(K[i]["exec"])?"onClick=\"deepEditor.execCmd('"+K[i]["cmd"]+"',true,'');\" /></span>":"onClick=\"deepEditor.viewSubMenu('"+K[i]["cmd"]+"');\" /></span>"}F+="</div>";if(this.editorOption.viewtag!=false){F+='<div id="sourceMode" onclick="ChangeEditor(\'src\');">'+this.msg.tagView+"</div>"}this.objToolBar.innerHTML=F;var N=I.fontlist;var B="";for(i=0;i<N.length;i++){B+="<li onclick=\"deepEditor.execCmd('FontName',false,'"+N[i]["name"]+'\')" style="font-family:'+N[i]["name"]+';">'+N[i]["name"]+"</li>"}document.getElementById("fontlist").innerHTML=B;var H=I.fontsize;var A="";for(i=0;i<H.length;i++){A+="<li onclick=\"deepEditor.execCmd('FontSize',false,'"+H[i]["size"]+'\')" style="font-size:'+H[i]["css"]+';">ABC</li>'}document.getElementById("fontsize").innerHTML=A;var G="";G+='<li>URL <input type="text" id="createlink-url" /> <input type="button" value="ok" onClick="deepEditor.execCmd(\'createLink\',false,document.getElementById(\'createlink-url\').value);" /></li>';document.getElementById("createlink").innerHTML=G;var D=I.color;var C="";C+='<div class="color-item-group">';for(i=1;i<D.length+1;i++){C+='<span class="color-item" style="background-color:#'+D[i-1]["color"]+';"><img src="'+this.editorOption.path+"clear.gif\" style=\"width:14px;height:14px;border:0px;\"onclick=\"deepEditor.execCmd('ForeColor','','#"+D[i-1]["color"]+"');\"></span>";if(i%5==0&&i!=D.length){C+='</div><div class="color-item-group">'}}C+="</div></div>";document.getElementById("forecolor").innerHTML=C;var E=(navigator.userAgent.indexOf("MSIE")>0)?"BackColor":"hilitecolor";C="";C+='<div class="color-item-group">';for(i=1;i<D.length+1;i++){C+='<span class="color-item" style="background-color:#'+D[i-1]["color"]+';"><img src="'+this.editorOption.path+'clear.gif" style="width:14px;height:14px;border:0px;"onclick="deepEditor.execCmd(\''+E+"','','#"+D[i-1]["color"]+"');\"></span>";if(i%5==0&&i!=D.length){C+='</div><div class="color-item-group">'}}C+="</div></div>";document.getElementById("backcolor").innerHTML=C};this.Init=function(F,C,E,B){this.editorType=C;this.selection=null;this.subMenuItem=new Array("fontlist","fontsize","backcolor","forecolor","createlink");this.objHtmlDoc=document.getElementById("htmlDoc").contentWindow.document;this.objTextDoc=document.getElementById("textDoc");this.objSrcDoc=document.getElementById("srcDoc");this.objHtmlDiv=document.getElementById("htmlDiv");this.objTextDiv=document.getElementById("textDiv");this.objSrcDiv=document.getElementById("srcDiv");this.objToolBar=document.getElementById("toolBar");this.objEmptyBar=document.getElementById("emptyBar");this.bSetSubMenuPos=false;this.lang=F;this.msg=E;this.editorOption=B;this.MakeToolBar();var D=document.getElementById("etype-html");var A=document.getElementById("etype-text");if(this.editorType=="html"){this.objToolBar.style.display="block";this.objEmptyBar.style.display="none";this.objTextDiv.style.display="none";this.objHtmlDiv.style.display="block";D.style.fontWeight="bold";D.style.color="#000000";A.style.color="#666666";this.setSubMenuPos()}else{this.objToolBar.style.display="none";this.objEmptyBar.style.display="block";this.objTextDiv.style.display="block";this.objHtmlDiv.style.display="none";A.style.fontWeight="bold";D.style.color="#666666";D.style.borderRight="0px";A.style.color="#000000"}this.bodyHead="<html>\n<head><style>p{margin:0px;padding:0px;}</style></head>\n<body style=\"font-family: 'MS Gothic','MS PGothic','MS UI Gothic','Hiragino Kaku Gothic Pro';font-size:9pt;line-height:1.4;letter-spacing:1pt;\">\n";this.bodyTail="\n</body>\n</html>\n"};this.ToggleMenu=function(E,C){if(this.srcMode){return }var D="toolbar-"+E;var A=document.getElementById(D);var B=(C)?"url("+this.editorOption.path+E+"_on.gif)":"url("+this.editorOption.path+E+".gif)";A.style.backgroundImage=B};this.execCmd=function(D,E,C){if(this.srcMode){return }if(D=="createLink"){var A=C;if(A.substr(0,7).toLowerCase()!="http://"&&A.substr(0,8).toLowerCase()!="https://"&&A.substr(0,6).toLowerCase()!="ftp://"&&A.substr(0,7).toLowerCase()!="mailto:"){C="http://"+C}}if(E&&D.indexOf("color")<0){this.objHtmlDoc.execCommand(D,"",C)}else{if(this.objHtmlDoc.selection){this.selection.execCommand(D,E,C)}else{if(this.objHtmlDoc.getSelection){var B=this.objHtmlDoc.getSelection();B.removeAllRanges();B.addRange(this.selection)}this.objHtmlDoc.execCommand(D,E,C)}}this.hideAllSubMenu()};this.viewSubMenu=function(A){this.hideAllSubMenu();if(this.srcMode){return }if(this.objHtmlDoc.selection){this.selection=this.objHtmlDoc.selection.createRange()}else{if(this.objHtmlDoc.getSelection&&this.objHtmlDoc.getSelection().rangeCount){this.selection=this.objHtmlDoc.getSelection().getRangeAt(0)}}var B=document.getElementById(A);B.style.display=(B.style.display=="block")?"none":"block"};this.hideAllSubMenu=function(){var A;for(i=0;i<this.subMenuItem.length;i++){A=document.getElementById(this.subMenuItem[i]);if(A!=null){A.style.display="none"}}};this.setSubMenuPos=function(){if(this.bSetSubMenuPos){return }if(this.editorOption.fontlist!=false){document.getElementById("fontlist").style.left=parseInt(document.getElementById("toolbar-fontlist").offsetLeft)+"px"}if(this.editorOption.fontsize!=false){document.getElementById("fontsize").style.left=parseInt(document.getElementById("toolbar-fontsize").offsetLeft)+"px"}if(this.editorOption.color!=false){document.getElementById("forecolor").style.left=(parseInt(document.getElementById("toolbar-forecolor").offsetLeft)-3)+"px"}if(this.editorOption.color!=false){document.getElementById("backcolor").style.left=parseInt(document.getElementById("toolbar-backcolor").offsetLeft)+"px"}if(this.editorOption.link!=false){document.getElementById("createlink").style.left=(parseInt(document.getElementById("toolbar-createlink").offsetLeft)-3)+"px"}this.bSetSubMenuPos=true};this.setSrcMode=function(A){this.srcMode=(A=="auto")?!this.srcMode:A;if(this.srcMode){this.hideAllSubMenu();this.objSrcDoc.value=this.objHtmlDoc.body.innerHTML;this.objTextDiv.style.display="none";this.objHtmlDiv.style.display="none";this.objSrcDiv.style.display="block"}else{this.objHtmlDoc.body.innerHTML=this.objSrcDoc.value;this.objTextDiv.style.display="none";this.objHtmlDiv.style.display="block";this.objSrcDiv.style.display="none";this.objToolBar.style.display="block";this.objEmptyBar.style.display="none"}};this.changeEditor=function(B){if(this.editorType==B){if(B=="html"&&this.srcMode){this.setSrcMode(false)}return true}var C=document.getElementById("etype-html");var A=document.getElementById("etype-text");if(B=="text"){this.hideAllSubMenu();if(this.srcMode){this.objHtmlDoc.body.innerHTML=this.objSrcDoc.value}this.srcMode=false;this.objToolBar.style.display="none";this.objEmptyBar.style.display="block";this.objHtmlDiv.style.display="none";this.objSrcDiv.style.display="none";this.objTextDiv.style.display="block";this.editorType="text";A.style.fontWeight="bold";C.style.fontWeight="";C.style.color="#666666";A.style.color="#000000";this.objTextDoc.focus();this._htmlToText();return true}else{if(B=="html"){this.srcMode=false;this.objToolBar.style.display="block";this.objEmptyBar.style.display="none";this.objTextDiv.style.display="none";this.objSrcDiv.style.display="none";this.objHtmlDiv.style.display="block";this.editorType="html";A.style.fontWeight="";C.style.fontWeight="bold";C.style.color="#000000";A.style.color="#666666";this.setSubMenuPos();this._textToHtml();this.objHtmlDoc.body.focus();return true}}};this.getContent=function(A){if(this.srcMode){this.objHtmlDoc.body.innerHTML=this.objSrcDoc.value}if(this.editorType=="html"&&A=="text"){this._htmlToText()}if(this.editorType=="text"&&A=="html"){this._textToHtml()}if(A=="text"){return this.objTextDoc.value}else{return(this.editorType=="html")?(this.bodyHead+this.objHtmlDoc.body.innerHTML+this.bodyTail):""}};this.setContent=function(B,D,C){var A=(B==this.editorType)?C:(B=="text"?this.textToHtml(C):this.htmlToText(C));if(this.editorType=="html"){if(this.srcMode){this.objSrcDoc.value=(D==0)?A:(D==1)?(A+this.objSrcDoc.value):(this.objSrcDoc.value+A)}else{this.objHtmlDoc.body.innerHTML=(D==0)?A:(D==1)?(A+this.objHtmlDoc.body.innerHTML):(this.objHtmlDoc.body.innerHTML+A)}}else{this.objTextDoc.value=(D==0)?A:(D==1)?(A+this.objTextDoc.value):(this.objTextDoc.value+A)}};this._htmlToText=function(){if(navigator.userAgent.indexOf("Safari")>0){this.objTextDoc.value=this.objHtmlDoc.body.innerText}else{this.objTextDoc.value=this.htmlToText(this.objHtmlDoc.body.innerHTML)}};this._textToHtml=function(){this.objHtmlDoc.body.innerHTML=this.textToHtml(this.objTextDoc.value)};this.htmlToText=function(B){var A=B.replace(/(\r|\n|\t)/mg,"");A=A.replace(/<br\s*\/?>/mgi,"\n");A=A.replace(/<\/p\s*\/?>/mgi,"\n");A=A.replace(/<style[^>]*>.*<\/style>/mgi,"");A=A.replace(/(<[^>]+>)/mg,"");A=A.replace(/&amp;/mg,"&");A=A.replace(/&nbsp;/mg," ");A=A.replace(/&lt;/mg,"<");A=A.replace(/&gt;/mg,">");return A};this.textToHtml=function(C){var B=C.replace(/&/mg,"&amp;");B=B.replace(/ /mg,"&nbsp;");B=B.replace(/</mg,"&lt;");B=B.replace(/>/mg,"&gt;");B=B.replace(/\r\n/mg,"</p><p>");B=B.replace(/\n/mg,"</p><p>");var A=B[B.length-3]+B[B.length-2]+B[B.length-1];var B=(A=="<p>")?("<p>"+B.substr(0,B.length-3)):("<p>"+B+"</p>");return B.replace(/<p><\/p>/mg,"<br />")}};