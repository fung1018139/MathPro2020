var BACKSPACE_IGNORE=0;var INTERVAL=null;var DRAGGING=0;$.modal={currentFocus:null,isConfirm:false,alert:function(B,A){$(".alertBtn").show();$(".confirmBtn").hide();$.modal._showModal(B,A,"");$.modal.currentFocus=$("*:focus")},confirm:function(E,D,A,C,B){$(".alertBtn").hide();$(".confirmBtn").show();$.modal._showModal(E,D);$.modal.isConfirm=true;if(typeof A=="function"){$("#modalCallBackYes").one("click",function(){A();$.modal.close()})}if(typeof B=="function"){$("#modalCallBackEtc").show();$("#modalCallBackEtc").one("click",function(){B();$.modal.close()})}if(typeof C=="function"){$("#modalCallBackNo").one("click",function(){C();$.modal.close()})}else{$("#modalCallBackNo").one("click",function(){$.modal.close()})}},close:function(){$("#modalDiv").fadeOut();$("#modalWrap").hide();if($.modal.currentFocus!=null){$.modal.currentFocus.focus()}$.modal.currentFocus=null;$("#modalCallBackYes").off("click");$("#modalCallBackNo").off("click");$.modal.isConfirm=false},_showModal:function(E,D){var A=$(document).height();var C=($(document).width()-$("#modalDiv").width())/2;var B=A/4;$("#modalWrap").width("100%");$("#modalWrap").height(A);$("#modalWrap").show();$("#modalTitle").html(E);$("#modalMsg").html(D);$("#modalDiv").css("top",B);$("#modalDiv").css("left",C);$("#modalDiv").fadeIn()}};var Set=function(){this._array=new Array();this.Hit=function(B){for(var A=0;A<this._array.length;A++){if(B==this._array[A]){return A}}return -1};this.Set=function(A){this._array.push(A)};this.UnSet=function(B){var A=this.Hit(B);if(A>=0){this._array[A]=""}};this.ReSet=function(){this._array=[]};this.Size=function(){return this._array.length}};String.prototype.trim=function(){return this.replace(/(^ *)|( *$)/g,"")};function roundXL(C,B){if(B>=0){return parseFloat(parseFloat(C).toFixed(B))}B=Math.pow(10,B);var A=Math.round(C*B);return parseFloat(A.toFixed(0))}function GoMailBox(C){if(NEW_WIN==1){parent.close();return }if(C!=""&&$("#mainform").find('input[name="submode"]').val()=="search"){parent.DetailSearch("search");return }var A,B;A="maillist.cgi";if(C==""||parent.document.getElementById("listform")==null){B="mbox=inbox";parent.loadMailList(A,B,"html",false,true);return }parent.$gvar.maillistmode.val("");parent.$gvar.maillistmbox.val(C);B=parent.$gvar.maillistform.serialize();parent.loadMailList(A,B,"html",false,true)}function CancelCompose(D){switch(D){case 0:$.modal.confirm(msgComposer.confirm,msgComposer.cancel_q,function(){CancelCompose(1)},"",function(){CancelCompose(2)});break;case 1:var C=$("#mainform").find('input[name="autosavekey"]').val();var B=$("#mainform").find('input[name="mode"]').val();var A=(B=="draft"||B=="outbox"||B=="reservemail")?$("#mainform").find('input[name="key"]').val():"";if(C!=""||A!=""){$.post("move.cgi",{mode:"cancel_composer",autosave_del_key:C,mbox:B,del_key:A},function(E){if(E==1){ExitComposer(B)}else{$.modal.alert(msgComposer.alert,msgComposer.sc18)}return })}else{B="inbox";ExitComposer(B);return }break;case 2:SaveDraft()}}function ExitComposer(B){if(NEW_WIN==1){if($("#fromhtml").val()=="pims"){if(_ExistFunction(parent.opener.parent,"treeMenuRefresh")){parent.opener.parent.treeMenuRefresh()}parent.close();return }var A=_ExistFunction(parent.opener,"treeMenuRefresh");if(A){if(B=="draft"||B=="outbox"||B=="reservemail"){parent.opener.loadMailList("maillist.cgi","mbox="+B,"html",true,true)}else{parent.opener.treeMenuRefresh()}}parent.close();return }if(B==""){B="inbox"}parent.loadMailList("maillist.cgi","mbox="+B,"html",false,true);return }function AddAddr(C,B){if(C==""){var E=B.indexOf("@");C=B.substring(0,E)}var F="width=716,height=675,resizable=yes,scrollbars=yes";var A=window.open("","addmemberfrommail",F);A.focus();var D=document.addrform;D.mode.value="addfrommail";D.name.value=C;D.email.value=B;D.target="addmemberfrommail";D.action="addressbook.cgi";D.submit()}function OnReSizeWidth(){if($(document).width()>775){$(".rcptPullDown").css("left","");$(".rcptPullDown").css("right",24)}else{$(".rcptPullDown").css("right","");$(".rcptPullDown").css("left",736)}if($("#sendResult").css("display")!="none"){var A=($(window).width()-$("#sendResult").width())/2;if(A>0){$("#sendResult").css({"margin-left":A,"margin-right":A})}}if($("#webfileWrap").css("display")!="none"){var A=($(window).width()-720)/2;if(A<0){A=2}$("#webfileWrap").css("margin-left",A+"px")}if($("#accessid").css("display")!="none"){var A=($(window).width()-520)/2;if(A<0){A=2}$("#accessid").css("margin-left",A+"px")}}function OnReSizeHeight(){var B=$("#contentWrap").position();var A=$(window).height()-B.top-70;var C=navigator.userAgent.toLowerCase();if((C.indexOf("safari")!=-1)&&(C.indexOf("version/5")!=-1)){if(A<260){A=260}if($("#htmlDiv").height()>=260){$("#htmlDiv").height(A);$("#textDiv").height(A);$("#srcDiv").height(A)}}else{$("#htmlDiv").height(A);$("#textDiv").height(A);$("#srcDiv").height(A)}if($("#sendResultWrap").css("display")!="none"){$("#sendResultWrap").height($(document).height())}if($("#modalWrap").css("display")!="none"){$("#modalWrap").height($(document).height())}}function CreateRcpt(C){InitRcpt(C);var B=$("#mainform");var A='input[name="s'+C+'"]';return B.find(A).val()}function GetEasyAddress(B){if($("input[name=easyaddress]:checkbox:checked").length==0){if(B=="easydelete"){$.modal.alert(msgComposer.alert,msgComposer.sc19_delete)}else{$.modal.alert(msgComposer.alert,msgComposer.sc19_add)}return }if(B=="replyto_t"&&$("input[name=easyaddress]:checkbox:checked").length>1){$.modal.alert(msgComposer.alert,msgComposer.sc20);return }var E=new Array();var D=new Array();var A="",F="";$("input[name=easyaddress]:checkbox:checked").each(function(){E.push($(this).attr("mname"));D.push($(this).val());if(B=="easydelete"){A+=DelQuot($(this).attr("mname"))+"";F+=$(this).val()+""}});if(B=="easydelete"){if(!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.sc17,function(){GetEasyAddress(B)});return }$.post("composer.cgi",{mode:B,del_mail:F,del_name:A},function(J){if(J==1){$("input[name=easyaddress]:checkbox:checked").each(function(){$(this).parent().parent().remove();var L=$(this).attr("mname");var K=$(this).val();$("#easyPullDown > li").each(function(){if($(this).attr("ename")==L&&$(this).attr("email")==K){$(this).remove();return }});if($("#easyPullDown").children().length==0){$("#easyPullDown").html('<p style="font-size:11px;line-height:11px;padding:2px;">'+msgComposer.noitem+"</p>")}});if($("#easyAddressWrap").children().length==0){$("#easyAddressWrap").html('<li class="easyaddr-itemlist-noitem">'+msgComposer.noitem+"</li>")}}else{$.modal.alert(msgComposer.alert,msgComposer.sc18)}}).fail(function(){$.modal.alert(msgComposer.alert,msgComposer.sc18)});return }var H=(B=="replyto_t"?"#trReplyto":(B.indexOf("cc")>=0?".trBcc":""));if(H!=""&&$(H).css("display")=="none"){Toggle(H,false,"img-"+H.substr(1))}for(var C=0;C<D.length;C++){var G=$("#"+arrRcptForm[0]).val().length+$("#"+arrRcptForm[1]).val().length+$("#"+arrRcptForm[2]).val().length+$("#"+arrRcptForm[3]).val().length;if(G==0||!CheckEasyAddress(B,D[C])){var I=(E[C].length>0)?(E[C]+" <"+D[C]+">"):D[C];if(B=="replyto_t"){if($("#"+B+"list").children().length!=0){if(!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.sc20+"<br>"+msgComposer.sc20_,function(){GetEasyAddress(B)});return }}}_AddRcptItem(B,I)}}$("input[name=easyaddress]:checkbox:checked").each(function(){$(this).prop("checked",false)});$("#easyaddressDiv").hide();ReSetPopMenuArrow()}function CheckEasyAddress(H,D){var E=0;var B=0;var A=0;var G=$("#"+H).val();var F=new Array("to","cc","bcc","replyto_t");var C=new Array();C[F[0]]=msgComposer.callrcptdata_sc1;C[F[1]]=msgComposer.callrcptdata_sc2;C[F[2]]=msgComposer.callrcptdata_sc3;C[F[3]]=msgComposer.callrcptdata_sc9;while(true){G=G.substr(E);E=G.indexOf(",");B=G.indexOf("<");A=G.indexOf(">");if(E<0){if(B>0&&A>0){G=G.substr(B+1,A-B-1)}if(G==D){$.modal.alert(msgComposer.alert,D+" : "+msgComposer.callrcptdata_sc5+"["+C[H]+"]"+msgComposer.callrcptdata_sc6);return true}break}if((E!=-1)&&(B!=-1)&&(A!=-1)&&(E>B)){temp=G.substr(B+1,A-B-1)}else{temp=G.substr(0,E)}if(temp==D){$.modal.alert(msgComposer.alert,D+" : "+msgComposer.callrcptdata_sc5+"["+C[H]+"]"+msgComposer.callrcptdata_sc6);return true}E=E+1}return false}function DelQuot(B){var A=(B.charAt(0)=='"'&&B.charAt(B.length-1)=='"')?true:false;return(!A)?B:B.substr(1,B.length-2)}function AddQuot(C){var F=new RegExp("^[\u0020-\u007e]+$");var A=F.test(C);var E=C.indexOf(",")<0?false:true;var B=(C.charAt(0)=='"'&&C.charAt(C.length-1)=='"')?true:false;var G="";for(var D=0;D<C.length;D++){var H=C.charAt(D);if(H==","||H==";"||H=="@"){E=true}else{if(H=="!"||H=="$"||H=="%"||H=="("||H==")"||H=="\\"){if(A){E=true}}}G+=(H=='"')?"&quot;":H}G=(E&&!B)?("&quot;"+G+"&quot;"):G;return G}function ShowLayer(C){var A=$("#"+C);var B=A.css("display")=="block"?false:true;if(!B){A.fadeOut();ReSetPopMenuArrow();return }$("#mailopt").fadeOut();$("#easyaddressDiv").fadeOut();$("#signDiv").fadeOut();$("#cwordDiv").fadeOut();ReSetPopMenuArrow();if(C=="mailopt"){A.css("top",$("#headerWrap").position().top)}else{if(C=="easyaddressDiv"){A.css("top",$("#headerWrap").position().top-12)}else{A.css("top",$("#contentWrap").position().top+28)}}if(B){A.fadeIn();$("#"+C+"Btn").css("background-image","url(../extension/images/base/pulldownbtn_arrow_up.gif)")}return false}function Toggle(D,A,B){if(A){if($(D).css("display")=="none"){$(D).fadeIn()}else{$(D).fadeOut()}}else{$(D).toggle();OnReSizeWidth();OnReSizeHeight()}if(typeof B!=="undefined"){var C=$("#"+B);C.attr("src",(C.attr("src").indexOf("plus")>0?"../images/base/gen/rcpt_minus.png":"../images/base/gen/rcpt_plus.png"))}}function CalculationAttSize(F,C,E){var B=0;var A=0;$(".uploadItem").each(function(){B=parseFloat(B)+parseFloat($(this).attr("size"));A++});if(F=="check"){B=parseFloat(B)+(parseFloat(C)*1.33);if(USE_ATTACH_SIZE!=0){if(parseFloat(B)>parseFloat(MAX_ATTACH_SIZE)){return msgComposer.sc5}}A+=E;if(USE_ATTACH_COUNT!=0){if(A>MAX_ATTACH_COUNT){return msgComposer.sc4}}return""}if(F=="reload"){var G=(USE_ATTACH_SIZE==0)?"":("/"+roundXL(MAX_ATTACH_SIZE/1024/1024,2)+"MB");var D=(USE_ATTACH_COUNT==0)?"":("/"+MAX_ATTACH_COUNT);$("#attachSize").text(roundXL(B/1024/1024,2)+"MB"+G);$("#attachCount").text(A+D+msgComposer["15"]);$("#upfileform-single").find('input[name="upfilesize"]').val(B)}return true}function UploadQMng(G,C,A,F){if(G=="add"){if($("#dragMsg").children().size()>0){$("#dragMsg").remove()}var B=(F>=1024*1024?(roundXL(F/1024/1024,2)+"MB"):F>=1024?(roundXL(F/1024,2)+"KB"):(roundXL(F,2)+"B "));var D='<li id="'+C+'" class="uploadItem" size="'+F+'" filename="'+A+'">';D+='<span class="uploadQueueFilename"><p class="uploadQueueFilenameP">'+A+"</p></span>";D+='<span class="uploadQueueFilesize">'+B+"</span>";D+='<span class="uploadQueueOpen"><img src="../images/base/gen/attach_open.png" onclick="FileOpen(\''+C+"');\" /></span>";D+='<span class="uploadQueueDel"><img src="../images/base/gen/attach_cancel.png" onclick="FileDelete(\''+C+"');\" /></span></li>";$("#uploadQueue").append(D);if($("#uploadQueue").css("display")!="block"){Toggle("#uploadHeader",false,"imgAttach");Toggle("#uploadQueue",false)}}else{if(G=="del"){var E=parseInt(A);if(E+1==$(".uploadItem").size()){E--}$("#"+C).remove();$(".uploadItem").each(function(H,I){if(E==H){$(I).css("background-color","#dff1ff");$(I).attr("chk","1")}})}}}function AddAttach(){if(g_bOnUpload){$.modal.alert(msgComposer.alert,msgComposer.temp_upload_error);return }var A=new Date();if(window.File!==undefined){$("#multiUploadFile").trigger("click")}else{$("#upfile-single").click()}}function CleanAttach(A){if(UA.indexOf("trident")>0||(UA.indexOf("safari")>0&&UA.indexOf("chrome")<0)){$(A).replaceWith($("#multiUploadFile").clone(true))}else{$(A).val("")}}function ChkWebFile(A,B){if(g_bOnUpload){$.modal.alert(msgComposer.alert,msgComposer.temp_upload_error);return -1}g_bOnUpload=true;var C=false;$(".uploadItem").each(function(){for(var E=0;E<A.length;E++){if($(this).attr("filename")==A[E]){g_bOnUpload=false;C=true;return -1}}});if(C){$.modal.alert(msgComposer.alert,msgComposer.sc6);return -1}var D=CalculationAttSize("check",B,A.length);if(D!=""){$.modal.alert(msgComposer.alert,D);g_bOnUpload=false;return -1}return 0}function SingleUpload(D){var B=new Array();if(g_bOnUpload){B.push("-2");return B}g_bOnUpload=true;var C=false;$(".uploadItem").each(function(){if($(this).attr("filename")==D){$.modal.alert(msgComposer.alert,msgComposer.sc6);g_bOnUpload=false;C=true;B.push("-1")}});if(C){return B}var E=CalculationAttSize("check",0,1);if(E!=""){$.modal.alert(msgComposer.alert,E);g_bOnUpload=false;B.push("-1");return B}var A=0;B.push(USE_ATTACH_SIZE);B.push(MAX_ATTACH_SIZE);$(".uploadItem").each(function(){A=parseFloat(A)+parseFloat($(this).attr("size"))});B.push(A);return B}function _ShowProgressBar(B,A){$("#prgBar").html("");$("#upbarDiv").show();$("#prgTitle").html(A);ShowProgressBar(B);INTERVAL=setInterval(function(){ShowProgressBar(B)},1000)}function ShowProgressBar(A){var B="dir="+$("#mainform").find('input[name="dirname"]').val()+"&key="+A+"&ml_session="+ML_SESSION+"&dummy="+(new Date().getTime());$.get("upload_prgbar.cgi",B,function(C){var D='<span id="progressbar" style="display:inline-block;border:1px solid #000;background-color:#FFFFFF; width:100px;;margin:1px;height:5px;"><img src="../images/base/gen/percent.png" style="width:'+C+'px;height:5px;vertical-align:text-top;float:left;" /></span><span> '+C+"%</span>";$("#prgBar").html(D);if(C>=100){clearInterval(INTERVAL);setTimeout(function(){$("#upbarDiv").fadeOut(500)},1000)}})}function MultiUpload(D){if(g_bOnUpload){$.modal.alert(msgComposer.alert,msgComposer.temp_upload_error);return }g_bOnUpload=true;for(i=0;i<D.length;i++){var C=false;$(".uploadItem").each(function(){if($(this).attr("filename")==D[i].name){C=true;return }});if(C){CleanAttach("#multiUploadFile");$.modal.alert(msgComposer.alert,msgComposer.sc6);g_bOnUpload=false;return }}var A=new Date().getTime()+"_";var B=0;for(i=0;i<D.length;i++){B+=parseFloat(D[i].size)}var E=CalculationAttSize("check",B,D.length);if(E!=""){$.modal.alert(msgComposer.alert,E);g_bOnUpload=false;return }$("#upbarDiv").show();UploadFile(D,A,0)}function UploadFile(D,C,B){var A=0;$(".uploadItem").each(function(){A=parseFloat(A)+parseFloat($(this).attr("size"))});var E=new FormData();E.append("mode","");E.append("_encode_mode","1");E.append("useattachsize",USE_ATTACH_SIZE);E.append("maxupfilesize",MAX_ATTACH_SIZE);E.append("upfilesize",parseFloat(A));E.append("dirname",$("#mainform").find('input[name="dirname"]').val());E.append("_dmode_file_name",C+B);E.append("_dmode_file",D[B]);$("#prgTitle").html("["+(parseInt(B)+1)+"/"+D.length+"] &nbsp;"+D[B].name);var F=new XMLHttpRequest();F.open("POST",ML_SESSION==1?"mluploadprocess.cgi":"uploadprocess_ex.cgi");F.onload=function(){};F.upload.addEventListener("progress",function(G){var I=Math.round(G.loaded/G.total*100);if(I>100){return false}var H='<span id="progressbar" style="display:inline-block;border:1px solid #000;background-color:#FFFFFF; width:100px;;margin:1px;height:5px;"><img src="../images/base/gen/percent.png" style="width:'+I+'px;height:5px;vertical-align:text-top;float:left;" /></span><span> '+I+"%</span>";$("#prgBar").html(H)},false);F.onreadystatechange=function(){if(F.readyState==4){if(F.status==200){if(F.responseText.indexOf("1,")==0){var H='<span id="progressbar" style="display:inline-block;border:1px solid #000;background-color:#FFFFFF; width:100px;;margin:1px;height:5px;"><img src="../images/base/gen/percent.png" style="width:100px;height:5px;vertical-align:text-top;float:left;" /></span><span> complete</span>';$("#prgBar").html(H);var G=F.responseText.split(",");UploadQMng("add",C+B,D[B].name,G[1]);CalculationAttSize("reload");if(B+1<D.length){setTimeout(function(){UploadFile(D,C,B+1)},700)}else{setTimeout(function(){$("#upbarDiv").fadeOut(500)},1000);CleanAttach("#multiUploadFile");$("input[name=autosavemd5]").val("");g_bOnUpload=false}}else{g_bOnUpload=false;var G=F.responseText.split(",");UploadError(G[1],G[2]);CleanAttach("#multiUploadFile")}}}};F.send(E)}function AddWebFileAttach(){$("#sendResultWrap").width("100%");$("#sendResultWrap").height($(document).height());$("#sendResultWrap").show();$.post("webfile.cgi",{mode:"attach"},function(B){var A=($(window).width()-720)/2;if(A<0){A=2}$("#webfileWrap").html(B);$("#webfileWrap").css("margin-top",$("#headerWrap").position().top);$("#webfileWrap").css("margin-left",A+"px");$("#webfileWrap").slideDown("fast");$(".root").show();$("#sendResultWrap").height($(document).height());$("#webfileFolder > li").each(function(){if($(this).attr("key")=="root"){$(this).css("background-color",COLOR);return }})}).fail(function(){$("#webfileWrap").hide();$("#sendResultWrap").hide();$.modal.alert(msgComposer.alert,msgComposer.sc18)});return }function FileOpen(C){var A=$("#upfileform");A.find('input[name="mode"]').val("open");var B=C;if(C==""){$(".uploadItem").each(function(){if($(this).attr("chk")=="1"){B=$(this).attr("id")}})}if(B==""){$.modal.alert(msgComposer.alert,msgComposer.sc14);return }A.find('input[name="openfile"]').val(B);A.submit()}function FileDelete(B){var A=$("#upfileform");A.find('input[name="mode"]').val("delete");var D="";var C=0;$(".uploadItem").each(function(E,F){if(B!=""&&$(F).attr("id")==B){D=$(F).attr("id");C=E;return }});if(D==""){$.modal.alert(msgComposer.alert,msgComposer.sc7);return }A.find('input[name="filelist"]').val(D);$.post(A.attr("action"),A.serialize(),function(F){if(F=="1,"){UploadQMng("del",D,C);CalculationAttSize("reload");$("input[name=autosavemd5]").val("")}else{var E=F.split(",");UploadError(E[1],E[2])}}).fail(function(){UploadError(0)})}function UploadError(A,B){$("#upbarDiv").hide();if(A==0){$.modal.alert(msgComposer.error,msgComposer.sc10)}else{if(A==1){$.modal.alert(msgComposer.error,msgComposer.sc9)}else{if(A==2){$.modal.alert(msgComposer.error,msgComposer.sc10)}else{if(A==3){$.modal.alert(msgComposer.error,msgComposer.sc18)}else{if(A==4){$.modal.alert(msgComposer.error,msgComposer.sc10)}else{if(A==5){$.modal.alert(msgComposer.error,msgComposer.sc18)}else{if(A==6){$.modal.alert(msgComposer.error,msgComposer.sc5)}}}}}}}}function SetMacro(A){if(A==1){var B=$("#cwordkey").val();$(".cwordItem").hide();$("#cword-"+B).show()}}function SetSign(){var A=$("#signkey").val();$(".signItem").hide();$("#sign-"+A).show()}function AddMacro(C){var D="cword-"+$("#cwordkey").val();if(D=="cword-0"){return }$itemObj=$("#"+D+" > pre");if(typeof $itemObj==="undefined"){return }var A="";var B="";if(deepEditor.editorType=="text"){if(C==1){B="\n\n"}else{A="\n\n"}}deepEditor.setContent("text",C,A+$itemObj.text()+B)}function AddSign(D){if($("#signkey").val()=="0"){return }var F="sign-"+$("#signkey").val();$itemObj=$("#"+F);if(typeof $itemObj==="undefined"){return }var A=$itemObj.attr("t");var C=(A=="grp")?"html":"text";if(A=="grp"&&deepEditor.editorType=="text"){$.modal.alert(msgComposer.alert,msgComposer.image_sign_error);return }var B=(deepEditor.editorType=="text")?"\n\n":(D?"\n\n":"\n");var E=(A=="grp")?$itemObj.html().trim():(B+$("#"+F+" > pre").text());deepEditor.setContent(C,2,E);$("#signDiv").hide();ReSetPopMenuArrow()}function ChangeEditor(B){var A;if(B=="src"){deepEditor.setSrcMode("auto");if(deepEditor.srcMode){$(".toolbar-group").css("opacity","0.5");$("#toolbar-fontlist").css("opacity","0.5");$("#toolbar-fontsize").css("opacity","0.5");$("#sourceMode").css("color","#000000");$("#sourceMode").css("font-weight","bold");$("#sourceMode").css("background-color","#e5f3ff")}else{$(".toolbar-group").css("opacity","1");$("#toolbar-fontlist").css("opacity","1");$("#toolbar-fontsize").css("opacity","1");$("#sourceMode").css("color","#333333");$("#sourceMode").css("font-weight","");$("#sourceMode").css("background-color","#ffffff")}}else{if(B==deepEditor.editorType){return }if(B=="text"&&!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.change_text,function(){ChangeEditor("text")});return }deepEditor.changeEditor(B);if(B=="html"){$(".toolbar-group").css("opacity","1");$("#toolbar-fontlist").css("opacity","1");$("#toolbar-fontsize").css("opacity","1");$("#sourceMode").css("color","#333333");$("#sourceMode").css("font-weight","");$("#sourceMode").css("background-color","#ffffff");setTimeout(function(){$("#htmlDoc").contents().scrollTop(0)},50)}else{$("#cancelCID").val("1");$("#textDoc").setCursorPosition(0);$("#textDoc").scrollTop(0)}}}function handleDragStart(A){A.stopPropagation();A.preventDefault();return false}function handleDragOver(A){A.stopPropagation();A.preventDefault();if(window.opera&&DRAGGING<=0&&$("#dropDiv").css("display")=="none"){var B=g_bOnUpload?msgComposer.temp_upload_error:msgComposer.drag_msg;$("#dropDiv > div >p").css("line-height",$("#headerWrap").height()+"px");$("#dropDiv > div >p").html(B);$("#dropDiv").show();DRAGGING=0}}function handleDragEnter(A){if(DRAGGING>1){return }if(DRAGGING==0&&$("#modalWrap").css("display")!="block"){var B=g_bOnUpload?msgComposer.temp_upload_error:msgComposer.drag_msg;$("#dropDiv > div > p").html(B);$("#dropDiv > div >p").css("line-height",$("#headerWrap").height()+"px");$("#dropDiv").show()}DRAGGING++;A.stopPropagation();A.preventDefault()}function handleDragLeave(A){if(window.opera){if(DRAGGING>0){DRAGGING--}}else{DRAGGING--}A.stopPropagation();A.preventDefault();if(DRAGGING==0){$("#dropDiv").hide()}}function handleFileSelect(A){$("#dropDiv").hide();DRAGGING=0;if(g_bOnUpload){A.stopPropagation();A.preventDefault();return false}if(A.dataTransfer.files.length==0){A.stopPropagation();A.preventDefault();return false}else{if(A.dataTransfer.items){var D=A.dataTransfer.items.length;for(var B=0;B<D;B++){if(A.dataTransfer.items[B].webkitGetAsEntry){var C=A.dataTransfer.items[B].webkitGetAsEntry();if(C.isDirectory){A.stopPropagation();A.preventDefault();return false}}}}}if(typeof A.dataTransfer.files[0]=="undefined"){A.stopPropagation();A.preventDefault();return false}A.stopPropagation();A.preventDefault();MultiUpload(A.dataTransfer.files)}function SendMail(){if(g_bOnUpload==true){return }var A=$("#mainform");if(!ValidName(A.find('input[name="fromname"]').val())){A.find('input[name="fromname"]').focus();$.modal.alert(msgComposer.alert,msgComposer["65"]);return }if($("#tolist").children().size()==0){A.find('input[name="to"]').focus();$.modal.alert(msgComposer.alert,msgComposer.sc1);return }if(A.find('input[name="subject"]').val()==""&&!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.sc2,function(){SendMail()},function(){A.find('input[name="subject"]').focus()});return }if($("#reservation").is(":checked")){SetParam("reservation");var B=new Date();var C=B.getTime()/1000;if(Number(A.find('input[name="reservation_time1"]').val())<Number(C)){$.modal.alert(msgComposer.alert,msgComposer.sc12);return }}else{SetParam("mailsend")}g_nAutoSaveExec=0;$("#sendResultWrap").width("100%");$("#sendResultWrap").height($(document).height());$("#sendResultWrap").show();$("#asvLoading").css("top",$("#sendBtn").offset().top-3);$("#asvLoading > .asvWrap > .asvMacro").html(msgComposer["2"]);$("#asvLoading").fadeIn();var D=A.serialize();$.post("mailcreator.cgi",D,function(G,H){$("#asvLoading").fadeOut();if(H=="success"){$("#sendResult").html(G);var F=($(window).width()-$("#sendResult").width())/2;if(F>0){$("#sendResult").css({"margin-left":F,"margin-right":F})}$("#sendResult").slideDown("fast");if(NEW_WIN==0){parent.document.getElementById("strCurMenu").value="";parent.treeMenuRefresh()}else{_TreeMenuRefresh();var E=parent.opener;if(E.document.getElementById("list_mode")!=null&&E.document.getElementById("retarget")!=null&&E.document.getElementById("retarget").value=="maillist"){var K=E.document.getElementById("list_mbox").value;var J=$("#mainform").find('input[name="mode"]').val();var I=false;if(K=="draft"&&J=="draft"){I=true}if(K=="reservemail"&&J=="reservemail"){I=true}if(K=="outbox"&&J=="outbox"){I=true}if(K=="sent"&&$("#mainform").find('input[name="save"]').val()==1){I=true}if(I){E.Refresh(0)}}}}else{$.modal.alert(msgComposer.error,msgComposer.sent_error);$("#sendResultWrap").hide();g_nAutoSaveExec=1}}).fail(function(){$("#asvLoading").fadeOut();$.modal.alert(msgComposer.error,msgComposer.sent_error);$("#sendResultWrap").hide();g_nAutoSaveExec=1})}function BackComposer(){$("#sendResult").hide();$("#sendResultWrap").hide();g_nAutoSaveExec=1}function Preview(){if(g_bOnUpload==true){return }SetParam("preview");var C="width=650,height=500,toolbar=no,status=no,scrollbars=yes,resizable=yes";var B="../previewrelay.html?dummy="+(new Date().getTime());var A=window.open(B,"",C);A.focus()}function SaveDraft(){if(g_bAllowSend==false){return }if(g_bOnUpload==true){return }var A=$("#mainform");if(!ValidName(A.find('input[name="fromname"]').val())){A.find('input[name="fromname"]').focus();$.modal.alert(msgComposer.alert,msgComposer["65"]);return }SetParam("draft");g_bAllowSend=true;AjaxDraft()}function AjaxDraft(){g_nAutoSaveExec=0;var A=$("#mainform").serialize();$.post("mailcreator.cgi",A,function(D,F){if(F=="success"){var C=D.split(",");if(C[0]=="success"){var B=C[1];var E=C[2];var G=C[3];if(NEW_WIN==0){if(E==""){parent.loadMailList("maillist.cgi","mbox=draft","html",true,true)}else{if(E=="maillist.cgi"){parent.treeMenuRefresh();parent.loadMailList("maillist.cgi","mbox="+G,"html",false,true)}else{self.location.href=E;parent.treeMenuRefresh()}}}else{if(E==""){if(B=="pims"){if(_ExistFunction(parent.opener.parent,"loadMailList")){parent.opener.parent.loadMailList("maillist.cgi","mbox=draft","html",true,true)}}else{_LoadMailList(parent.opener,"maillist.cgi","mbox=draft","html",true,true)}}else{if(E=="maillist.cgi"){if(_ExistFunction(parent.opener,"treeMenuRefresh")){parent.opener.treeMenuRefresh();parent.opener.loadMailList("maillist.cgi","mbox="+G,"html",false,true)}}else{if(_ExistFunction(parent.opener,"treeMenuRefresh")){parent.opener.location.href=E;parent.opener.treeMenuRefresh()}}}parent.close()}}else{if(C[0]=="quotafull"){$.modal.alert(msgComposer.error,msgComposer["62"]);top.content.$gvar.currentpage.val("composer")}else{$.modal.alert(msgComposer.error,msgComposer["63"]);top.content.$gvar.currentpage.val("composer")}}}else{$.modal.alert(msgComposer.error,msgComposer["63"]);top.content.$gvar.currentpage.val("composer")}}).fail(function(){$.modal.alert(msgComposer.error,msgComposer["63"]);top.content.$gvar.currentpage.val("composer")})}function AutoSave(){if(g_nAutoSaveExec==0){setTimeout("AutoSave()",g_nAutoSaveTerm);return }$("#asvLoading").css("top",$("#sendBtn").offset().top-3);$("#asvLoading > .asvWrap > .asvMacro").html(msgComposer["59"]);$("#asvLoading").fadeIn();if(g_bAllowSend==false){return }SetParam("autosave");var A=$("#mainform");g_bAllowSend=true;var B=$("#mainform").serialize();$.post("mailcreator.cgi",B,function(D,E){if(E=="success"){var C=D.split(",");if(C[0]=="success"){$("input[name=autosavekey]").val(C[1]);$("input[name=autosavemd5]").val(C[2]);$("input[name=autosavecnt]").val(Number($("input[name=autosavecnt]").val())+1);$("#asvErrMsg").html("");if(NEW_WIN==0){parent.treeMenuRefresh()}else{if($("#fromhtml").val()=="pims"){if(_ExistFunction(parent.opener.parent,"treeMenuRefresh")){parent.opener.parent.treeMenuRefresh()}}else{_TreeMenuRefresh()}}}else{if(C[0]=="quotafull"){$("#asvErrMsg").html(msgComposer["60"]);$("input[name=autosavemd5]").val("")}else{if(C[0]=="md5equals"){}else{$("#asvErrMsg").html(msgComposer["61"]);$("input[name=autosavemd5]").val("")}}}}else{$("#asvErrMsg").html(msgComposer["61"]);$("input[name=autosavemd5]").val("")}setTimeout("$('#asvLoading').fadeOut()",1000);setTimeout("AutoSave()",g_nAutoSaveTerm)}).fail(function(){$("#asvErrMsg").html(msgComposer["61"]);$("input[name=autosavemd5]").val("");setTimeout("$('#asvLoading').fadeOut()",1000);setTimeout("AutoSave()",g_nAutoSaveTerm);$.modal.alert(msgComposer.error,msgComposer["61"])})}function InitRcpt(J,G){var D=$("#mainform");for(var F=0;F<arrRcptForm.length-1;F++){var I="";var E=arrRcptForm[F];if(J!=""&&J!=E){continue}var K="#"+E+"list > span";$(K).each(function(){var M=$(this).attr("name");var L=$(this).attr("email");var N=$(this).attr("type");if(G=="preview"&&N=="group"){I+=L.substr(0,L.indexOf("]")+1);I+=","}else{if(N=="group"||M==""){I+=L;I+=","}else{I+=M;I+=(" <"+L+">,")}}if($(this).hasClass("rcptNG")){D.find('input[name="isrcptcheck"]').val("1")}});var B='input[name="s'+E+'"]';D.find(B).val(I)}var A=$("#replyto_tlist").children().length>0?$("#replyto_tlist").children().first().attr("name"):"";var H=$("#replyto_tlist").children().length>0?$("#replyto_tlist").children().first().attr("email"):"";var C;if(A!=""){C=A}if(H!=""){C=(C=="")?H:(A+" <"+H+">")}D.find('input[name="replyto"]').val(C)}function SetParam(C){var A=$("#mainform");InitRcpt("",C);A.find('input[name="actiontype"]').val(C);A.attr("action","mailcreator.cgi");A.find('input[name="textbody"]').val("");A.find('input[name="body"]').val("");A.find('input[name="textbody"]').val(deepEditor.getContent("text"));if(deepEditor.editorType=="html"){A.find('input[name="body"]').val(deepEditor.getContent("html"))}A.find('input[name="save"]').val($("#o-save").is(":checked")?"1":"0");A.find('input[name="rcptindicationmode"]').val($("#o-rcptindicationmode").is(":checked")?"1":"0");A.find('input[name="disallowforward"]').val($("#o-disallowforward").is(":checked")?"1":"0");A.find('input[name="recived_confirm"]').val($("#o-recived_confirm").is(":checked")?"1":"0");A.find('input[name="msgtype"]').val(deepEditor.editorType=="html"?"2":"0");A.find('input[name="charset"]').val($("#charsetlist").val());A.find('input[name="prio"]').val($(":input:radio[name=priority]:checked").val());if($("#reservation").is(":checked")){var B=new Date($("#reservation_year").val(),$("#reservation_month").val()-1,$("#reservation_day").val(),$("#reservation_hour").val(),$("#reservation_minute").val(),0);A.find('input[name="reservation_time1"]').val(B.getTime()/1000);B=new Date($("#reservation_year").val(),$("#reservation_month").val()-1,$("#reservation_day").val(),0,0,0);A.find('input[name="reservation_time2"]').val(B.getTime()/1000)}if(FROM_DISPLAY_ALIAS==2){if(ALIAS_ID==A.find('input[name="h_fromid"]').val()&&ALIAS_DOMAIN==A.find('input[name="h_fromdomain"]').val()){A.find('input[name="fromid"]').val(A.find('input[name="h_fromid"]').val());A.find('input[name="fromdomain"]').val(A.find('input[name="h_fromdomain"]').val())}}}function ValidName(A){if(A.indexOf("<")>=0||A.indexOf(">")>=0){return false}return true}function RcptClear(A){for(var B=0;B<arrRcptForm.length-1;B++){$("#"+arrRcptForm[B]+"list").empty()}if(A>0&&$(".trBcc").css("display")=="none"){Toggle(".trBcc",false,"img-trBcc")}}function InitFromInfo(){$("#fromWrap").css("width",$("#fromList").width()-6);var A;$("#fromList > li").each(function(B){if(B==0){A=$(this).attr("emai")}if($(this).attr("default")=="1"){A=$(this).attr("email");return }});SetFrom(A,"full")}function SetFrom(H,E){var B="";var C="";var A="";var F="";var I=0;var D=$("#mainform");$("#fromList > li").each(function(){if(H==$(this).attr("email")){B=$(this).attr("email");C=$(this).attr("fromname");A=$(this).attr("replyto");F=$(this).attr("bcc").replace(//g,",");I=$(this).attr("fromtype");return }});if(B==""){B=$("#fromList > li:first").attr("email");I=$("#fromList > li:first").attr("fromtype")}if(E=="full"){$("#replyto_tlist").empty();$("#bcclist").empty();if(A!=""){_AddRcptItem("replyto_t",A);if($("#trReplyto").css("display")=="none"){Toggle("#trReplyto",false,"img-trReplyto")}}else{if($("#trReplyto").css("display")!="none"){Toggle("#trReplyto",false,"img-trReplyto")}}if(F!=""){if($(".trBcc").css("display")=="none"){Toggle(".trBcc",false,"img-trBcc")}_AddRcptItem("bcc",F)}else{if($("#cclist").children().length==0&&$(".trBcc").css("display")!="none"){Toggle(".trBcc",false,"img-trBcc")}}D.find('input[name="fromname"]').val(C)}$("#fromWrap").text(B);$("#fromList").attr("select",B);var G=B.split("@");D.find('input[name="h_fromid"]').val(G[0]);D.find('input[name="h_fromdomain"]').val(G[1]);if(I!=0){D.find('input[name="fromid"]').val(G[0]);D.find('input[name="fromdomain"]').val(G[1])}return true}function GetSavedFrom(){var A=$("#mainform");$("#fromWrap").css("width",$("#fromList").width()-6);if(FROM_EMAIL!=""){if(!SetFrom(FROM_EMAIL,"email")){InitFromInfo()}}}function SetImportance(C){C.src=C.src.indexOf("low")>0?"../images/base/gen/icon_impor.gif":"../images/base/gen/icon_impor_low.gif";var A=C.src.indexOf("low")>0?false:true;var B=A?"[value=1]":"[value=0]";$('input:radio[name="priority"]').filter(B).prop("checked",true)}function InitAttach(D){var A=new Array();Parse(A,D,"");for(var C=0;C<A.length;C++){var B=new Array();Parse(B,A[C],"");if(B.length!=3){continue}UploadQMng("add",B[0],ConvertHTML2Text(B[1]),Number(B[2]))}if(D!=""){CalculationAttSize("reload")}}function GoAfterSave(E){g_nAutoSaveExec=0;SetParam("draft");if(E=="composer.cgi"){if(confirm(msgComposer.sc15)){location.href=E}return true}var A=$("#mainform");if($("#textDoc").val()!=""){if(confirm(msgComposer.sc13)){if(!ValidName(A.find('input[name="fromname"]').val())){A.find('input[name="fromname"]').focus();$.modal.alert(msgComposer.alert,msgComposer["65"]);return }A.find('input[name="gourl"]').val(E);g_bAllowSend=true;$.modal.alert(msgComposer.alert,msgComposer.sc11);AjaxDraft()}else{if(E=="maillist.cgi"){var D=$("#goaftersave_mbox").val();var C="mbox="+D;var B=false;if(D=="spam"){B=true}parent.loadMailList(E,C,"html",B,true)}else{location.href=E}}}else{if(E=="maillist.cgi"){var D=$("#goaftersave_mbox").val();var C="mbox="+D;var B=false;if(D=="spam"){B=true}parent.loadMailList(E,C,"html",B,true)}else{location.href=E}}}function ConvertHTML2Text(A){A=A.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<br>/g,"\n").replace(/&quot;/g,'"');return A}function InitDate(E,D){E=Number(E);D=Number(D);var C="";if(E==0){for(var B=0;B<4;B++){C+='<option value="'+(D+B)+'" >'+(D+B)+"</option>"}$("#reservation_year").html(C)}else{var A=E+3;if(A<D){A=D}for(var B=E;B<=A;B++){C+='<option value="'+B+'" >'+B+"</option>"}$("#reservation_year").html(C);$("#reservation_year").val(D)}ChkDate()}function ChkDate(){var A=GetMaxDay($("#reservation_year").val(),$("#reservation_month").val());if(A<$("#reservation_day").val()){$("#reservation_day").val(A)}for(var B=A+1;B<32;B++){$("#reservation_day option[value='"+B+"']").prop("disabled",true)}for(var B=29;B<=A;B++){$("#reservation_day option[value='"+B+"']").prop("disabled",false)}}function _DisplayFromItem(A){if(A=="auto"&&$("#fromList").css("display")!="none"){A="hide"}if(A=="hide"){$("#fromList").hide();$("#fromWrap").css("border-radius","4px 0px 0px 4px");$("#fromPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");return }$("#fromPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow_up.gif)");$("#fromWrap").css("border-radius","4px 0px 0px 0px");$("#fromList").css("margin-top","24px");$("#fromList").slideDown("fast")}function _ModifyRcptPopup(B){var C=$(this).parent().parent();var A=C.position();$("#curRcptID").val(C.parent().attr("id"));$("#curRcptIndex").val(C.index());$("#modifyPopRcpt").removeClass($("#modifyPopRcpt").attr("class"));$("#tempRcpt").removeClass($("#tempRcpt").attr("class"));$("#modifyPopRcpt").addClass(C.attr("class"));$("#tempRcpt").addClass(C.attr("class"));$("#tempRcpt").attr("size",C.text().length);$("#modifyPopRcpt").css("top",A.top);$("#modifyPopRcpt").css("left",A.left);$("#tempRcpt").val(C.text().trim());$("#modifyPopRcpt").fadeIn();$("#tempRcpt").focus();inputRcpt.ReSet()}function _FocusRcpt(){$(this).parent().css("border-color",COLOR);$(this).parent().next().css("border-color",COLOR)}function _BlurRcpt(A){_AddRcptItem(A,"");$("#"+A).parent().css("border-color",(A=="to"?"#aaaaaa":"#dddddd"));$("#"+A).parent().next().css("border-color",(A=="to"?"#aaaaaa":"#dddddd"))}function _ModifyRcptItem(D){if($(this).val().length>10){$(this).attr("size",$(this).val().length+5)}if(D.data.blur==true||D.keyCode==13){if($(this).val().length==0){$("#modifyPopRcpt").fadeOut();return }var F=$("#curRcptID").val().substr(0,$("#curRcptID").val().length-4);var C=ParseEmailList($(this).val());if(C.length>1){D.stopPropagation();D.preventDefault();$.modal.alert(msgComposer.alert,msgComposer.sc16);return }var E=_MakeRcptItem(F,$(this).val(),$("#curRcptIndex").val());if(E!=""){$("#modifyPopRcpt").fadeOut();var A="#"+$("#curRcptID").val();var B=$(A).find("span").eq($("#curRcptIndex").val());B.replaceWith(E)}else{ChkDuplRcpt(F)}inputRcpt.ReSet()}return }function OnPasteRcptInptu(){var A=this;setTimeout(function(){var B=$(A).val();_AddRcptItem($(A).attr("id"),B)},100)}function _AddRcptItem(G,C){var H=$("#"+G);if(C==""){C=H.val().trim()}if(C==""){return }var I="";inputRcpt.ReSet();var E=ParseEmailList(C);for(var D=0;D<E.length;D++){I+=_MakeRcptItem(G,E[D],-1);if(G=="replyto_t"&&D==0){break}}if(I!=""){H.val("");H.attr("size",10);var A="#"+G+"list";if(G=="replyto_t"){$(A).html(I)}else{$(A).html($(A).html()+I);var F=$("#"+G+"PullDown");var B=($(A).parent().height()==21)?1:2;$(F).height($(A).parent().height()+B)}}ChkDuplRcpt(G)}function ChkDuplRcpt(C){if(C=="replyto_t"){return }var A="#dupl"+C;if($(A).val()!=""){var B=msgComposer.callrcptdata_sc5+" ["+C+"]"+msgComposer.callrcptdata_sc6+"<br><br>"+$(A).val();$.modal.alert(msgComposer.alert,B);$("#"+C).val("")}$(A).val("")}function _handleAddRcptItem(A){var H=false;var J=(A.keyCode)?A.keyCode:A.which;if(J==9||J==13||((J==188||J==186)&&!A.ctrlKey&&!A.shiftKey)){H=true}var D=$(this).val().trim();if(D==""){if(J==8){OnKeyRcptDel($(this).attr("id"))}return }if(H){var I="";inputRcpt.ReSet();var F=ParseEmailList(D);for(var E=0;E<F.length;E++){I+=_MakeRcptItem($(this).attr("id"),F[E],-1);if($(this).attr("id")=="replyto_t"&&E==0){break}}if(I!=""){$(this).val("");$(this).attr("size",10);var B="#"+$(this).attr("id")+"list";if($(this).attr("id")=="replyto_t"){$(B).html(I)}else{$(B).html($(B).html()+I)}var G=$("#"+$(this).attr("id")+"PullDown");var C=($(B).parent().height()==21)?1:2;$(G).height($(B).parent().height()+C);A.stopPropagation();A.preventDefault()}ChkDuplRcpt($(this).attr("id"))}return }function _MakeRcptItem(D,H,J){var I=ParseEmail(H.trim());if(I.length==0){return""}if(I[0]=="SKIP"){return""}var E="rcpt"+I[0];var B=I[1];var G=I[2];var C=false;if(D!="replyto_t"){if(inputRcpt.Hit(G)!=-1){C=true}else{$("#"+D+"list > span").each(function(L){if(J!=L&&$(this).attr("email")==G){C=true;return }})}}if(C){var F=$("#dupl"+D).val();if(F!=""){F+=", "}F+=G;$("#dupl"+D).val(F);return""}var K;if(I[0]!="GRP"){var A=(B=="")?G:(B+" &lt;"+G+"&gt;");K='<span class="rcptItem '+E+'" name="'+B+'" email="'+G+'" type="">'+A+' <a href="#"><img src="../images/base/gen/rcpt_edit.png" class="rcptModify" /></a> <a href="#"><img src="../images/base/gen/rcpt_del.gif" class="rcptDel" /></a></span>'}else{K='<span class="rcptItem '+E+'" name="" email="'+G+'" type="group">'+B+' <a href="#"><img src="../images/base/gen/rcpt_del.gif" class="rcptDel" /></a></span>'}inputRcpt.Set(G);return K}function ParseEmailList(F){if(F.trim()==""){return }var D;var C=false;var E=0;var A=new Array();for(var B=0;B<F.length;B++){D=F.charAt(B);if(D=='"'){C=!C}if(!C&&(D==","||D==";")){if(B-E-1>0){A.push(F.substr(E,B-E))}E=B+1}}A.push(F.substr(E,F.length-E));return A}function ParseEmail(I){var A;var C=false;var O=0;var E=0;var B=0;var H=0;var K=0;var J=false;var M=new Array();if(I==""){return M}for(var D=0;D<I.length;D++){A=I.charAt(D);if(A=='"'){C=!C}if(!C){if(A==" "){B=D}else{if(A=="<"){O=D}else{if(A==">"){E=D}else{if(A=="("){H=D}else{if(A==")"){K=D}}}}}}}var N=-1;var G="";var F="";var L=false;if(I.length==1){N=-1}else{if((O==0&&E==0||(O==0&&E==I.length-1))&&(B==0&&H==0&&K==0)){L=IsGroup(I);if(!L){N=1;G=(O==0&&E==I.length-1)?I.substr(1,I.length-2):I}}else{if((B==0||B==O-1||(B>0&&B<O))&&(O>0&&E==I.length-1)){N=2;G=I.substr(O+1,E-O-1);F=I.substr(0,O)}else{if(O==0&&E==0&&H>0&&K==I.length-1){N=0;G=I.substr(0,(B>0?B:H));F=I.substr(H+1,K-H-1)}else{if(O>0&&E>0){N=2;G=I.substr(O+1,E-O-1);F=I.substr(0,O);if(O<B){N=-2}}else{L=IsGroup(I)}}}}}G=G.trim();F=F.trim();if(C){M.push("SKIP");return M}if(L){I=Replace(I,"<","&lt;");I=Replace(I,">","&gt;");M.push("GRP");M.push(I.substr(0,I.indexOf("]")+1));M.push(I);return M}if(!L&&N==-1){I=Replace(I,"<","&lt;");I=Replace(I,">","&gt;");M.push("NG");M.push("");M.push(I);return M}if(!L&&N==-2){G=Replace(G,"<","&lt;");G=Replace(G,">","&gt;");F=Replace(F,"<","&lt;");F=Replace(F,">","&gt;");M.push("NG");M.push(AddQuot(F));M.push(G);return M}F=Replace(F,"<","&lt;");F=Replace(F,">","&gt;");G=Replace(G,"<","&lt;");G=Replace(G,">","&gt;");M.push(IsValidRcpt(F,G)?"OK":"NG");M.push(AddQuot(F));M.push(G);return M}function IsValidRcpt(B,A){if(!ValidName(B)){return false}if(HasMultiByte(A)){return false}return IsEmail(A)}function HasMultiByte(B){for(var A=0;A<B.length;A++){var C=B.charCodeAt(A);if(C<256){continue}return true}return false}function IsGroup(A){if(A.charAt(0)!="["){return false}if(A.charAt(A.length-1)=="]"){return true}var B=A.indexOf(":");if(B<0){return false}var C=A.indexOf("]");if(C<0||B>C){return false}if(A.indexOf("PG")>C){return true}return(A.indexOf("SG")>C)?true:false}function OnClickUploadQItem(){$(".uploadItem").css("background-color","#ffffff");$(".uploadItem").attr("chk","0");$(this).css("background-color","#dff1ff");$(this).attr("chk","1")}function OnClickCallRcpt(){var C="width=900,height=580,toolbar=no,status=no,scrollbars=yes,resizable=yes";var B="htmlparse.cgi?html=callrcptdata_pop.html";var A=window.open(B,"callrcptdata",C);A.focus()}function OnClickComposer(C){var D=false;var B=false;var A=$(C.target);if(A.hasClass("btnPullDown")||A.hasClass("btnPullDownArea")){$("#easyPullDown").hide();_DisplayFromItem("hide");ReSetRcptArrow();return true}if(A.hasClass("rcptPullDown")){D=true}if(A.attr("id")=="fromPullDown"){B=true}while(true){if(A.attr("id")=="mainform"){break}if(A.attr("id")!==""&&(A.attr("id")=="mailopt"||A.attr("id")=="easyaddressDiv"||A.attr("id")=="signDiv"||A.attr("id")=="cwordDiv")){return true}A=A.parent()}$("#mailopt").hide();$("#easyaddressDiv").hide();$("#signDiv").hide();$("#cwordDiv").hide();ReSetPopMenuArrow();if(!D){$("#easyPullDown").hide();ReSetRcptArrow()}if(!B){_DisplayFromItem("hide")}}function OnClickHtmlDoc(){$("#mailopt").hide();$("#easyaddressDiv").hide();$("#signDiv").hide();$("#cwordDiv").hide();$("#easyPullDown").hide();_DisplayFromItem("hide");ReSetRcptArrow();ReSetPopMenuArrow()}function OnClickRcptInput(){if($(this).val().length>10&&$(this).val().length<60){$(this).attr("size",$(this).val().length+5)}BACKSPACE_IGNORE=0;return }function OnClickRcptDel(){var C=$(this).parent().parent().parent().attr("id");if(C.length>4){C=C.substr(0,C.length-4);var D=$("#"+C+"PullDown");var B="#"+C+"list";$(this).parent().parent().remove();var A=($(B).parent().height()==21)?1:2;$(D).height($(B).parent().height()+A)}}function OnKeyRcptDel(B){if(BACKSPACE_IGNORE==1){return }var A="#"+B+"list";if($(A).children().size()==0){return }$(A).children().last().remove();BACKSPACE_IGNORE=1}function OnClickRcptPullDown(){var E=$(this).attr("id");var D=$(this);var A=D.position();$("#easyPullDown").css("top",A.top+$("#"+E).height()-15);$("#easyPullDown").css("left",A.left-$("#easyPullDown").width()-4);var C=(E=="toPullDown")?"1px solid #aaaaaa":"1px solid #dddddd";$("#easyPullDown").css("border",C);if($("#easyPullDown").attr("current")==E){$("#easyPullDown").toggle();ReSetRcptArrow();var B=$("#easyPullDown").is(":hidden")?"pulldownbtn_arrow.gif":"pulldownbtn_arrow_up.gif";$("#"+E).css("background-image","url(../extension/images/base/"+B+")")}else{ReSetRcptArrow();$("#easyPullDown").show();$("#"+E).css("background-image","url(../extension/images/base/pulldownbtn_arrow_up.gif)")}$("#easyPullDown").attr("current",E)}function OnClickEasyAddressItem(){var E=$("#easyPullDown").attr("current");for(var C=0;C<arrRcptForm.length;C++){if(E.indexOf(arrRcptForm[C])==0){var B=$(this).attr("ename");var A=$(this).attr("email");var D=(B=="")?A:(B+" <"+A+">");$("#"+arrRcptForm[C]).val(D);_AddRcptItem(arrRcptForm[C],"");break}}$("#easyPullDown").hide();ReSetRcptArrow()}function ReSetPopMenuArrow(){$("#mailoptBtn").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#easyaddressDivBtn").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#signDivBtn").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#cwordDivBtn").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)")}function ReSetRcptArrow(){$("#toPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#ccPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#bccPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)");$("#replyto_tPullDown").css("background-image","url(../extension/images/base/pulldownbtn_arrow.gif)")}function GoSubFolder(){var A=$(this).attr("key");var B=$("#currentFolder").val();if(A==B){return }$(".folderItem").css("background-color","");$(this).css("background-color",COLOR);if(A=="check"){$("."+$("#currentFolder").val()).hide();ShowAttachList(true)}else{if(B=="check"){ShowAttachList(false)}else{$("."+$("#currentFolder").val()).hide()}$("."+A).show()}$("#currentFolder").val(A)}function SetItem(C){var E=$("#"+C).prop("checked");var B=$("#webfileAtachCount").text();var D=parseInt($("#"+C).attr("filesize"));var A=parseInt($("#webfileAttachSize").attr("size"));$("#"+C).prop("disabled","true");if(E){$("#webfileAtachCount").text(parseInt(B)+1);A+=D}else{$("#webfileAtachCount").text(parseInt(B)-1);A-=D}$("#webfileAttachSize").attr("size",A);$("#webfileAttachSize").text(roundXL(parseFloat(A)/1024/1024,2)+" MB");setTimeout(function(){$("#"+C).removeAttr("disabled")},500)}function ShowAttachList(A){$("input[name=webfileFileItem]:checked").each(function(){if(A){$(this).parent().parent().show()}else{$(this).parent().parent().hide()}})}function UploadWebFile(){var C="";var A=new Array();var B=$("#webfileAttachSize").attr("size");$("input[name=webfileFileItem]:checked").each(function(){A.push($(this).attr("filename"));C+=($(this).val()+",")});if(C==""){$.modal.alert(msgComposer.alert,msgComposer.sc3);return }if(ChkWebFile(A,B)!=0){return }$.post("webfile.cgi",{dirname:$("#mainform").find('input[name="dirname"]').val(),attach_list:C,mode:"attach_process"},function(H){var F=H.split("");var G="";for(var E=0;E<F.length;E++){var D=F[E].split("");if(D.length<2||D[1]==""){continue}if(D[2]==""){D[2]=A[E]}if(D[1]=="OK"){UploadQMng("add",D[0],D[2],D[3])}else{if(G!=""){G+=","}G+=D[2]}}if(G!=""){G+=(" : ["+msgComposer.webfile_sendmail1+"]");$.modal.alert(msgComposer.error,G)}else{$("#webfileWrap").hide();$("#sendResultWrap").hide()}CalculationAttSize("reload");g_bOnUpload=false})}function _ExistFunction(B,A){for(var C in B){if(C==A){return true}}return false}function _TreeMenuRefresh(){if(_ExistFunction(parent.opener,"treeMenuRefresh")){parent.opener.treeMenuRefresh()}}function _LoadMailList(B,E,D,A,C,F){if(_ExistFunction(B,"loadMailList")){B.loadMailList(E,D,A,C,F)}}function MakeAccessID(){$("#sendResultWrap").width("100%");$("#sendResultWrap").height($(document).height());$("#sendResultWrap").show();$("#accessid").show()}function SetSelectBox(A){if(A.length>0){$("#_year").attr("disabled",true);$("#_month").attr("disabled",true);$("#_day").attr("disabled",true);$("#_hour").attr("disabled",true);$("#_min").attr("disabled",true);$("#_year").css("backgroundColor","#dcdcdc");$("#_month").css("backgroundColor","#dcdcdc");$("#_day").css("backgroundColor","#dcdcdc");$("#_hour").css("backgroundColor","#dcdcdc");$("#_min").css("backgroundColor","#dcdcdc")}else{$("#_year").attr("disabled",false);$("#_month").attr("disabled",false);$("#_day").attr("disabled",false);$("#_hour").attr("disabled",false);$("#_min").attr("disabled",false);$("#_year").css("backgroundColor","#ffffff");$("#_month").css("backgroundColor","#ffffff");$("#_day").css("backgroundColor","#ffffff");$("#_hour").css("backgroundColor","#ffffff");$("#_min").css("backgroundColor","#ffffff")}}function SetDate(){if($("#_year").val()==""||$("#_month").val()==""){$("#_day option").remove()}else{var C=GetMaxDay($("#_year").val(),$("#_month").val());$("#_day option").remove();for(i=0;i<C;i++){var A=i+1;var B='<option value="'+A+'">'+A+"</option>";$("#_day").append(B)}}}function SetTextBox(B){var A=true;var C=true;var E="#dcdcdc";var D="#dcdcdc";if(B==0||B==1){A=false;C=true;E="#ffffff";D="#dcdcdc";$("#_hint").val("")}else{if(B==2){A=false;C=false;E="#ffffff";D="#ffffff"}else{if(B==3){$("#_pwd").val("");$("#_hint").val("")}}}$("#_pwd").attr("disabled",A);$("#_hint").attr("disabled",C);$("#_pwd").css("backgroundColor",E);$("#_hint").css("backgroundColor",D)}function OnClickWebFiletDel(){if($("#attachWebFileDiv > li").size()==1){$.modal.alert(msgComposer.alert,msgComposer.webfile_can_not_delete);return }$(this).parent().remove()}function DisplayComposer(){if($("#_pwd").val().length==0&&$("#_pwd_type").val()!=3){$("#_pwd").focus();$.modal.alert(msgComposer.alert,msgComposer.webfile_wrong_passwd1);return }if(!CheckPasswd($("#_pwd").val())){$("#_pwd").focus();$.modal.alert(msgComposer.alert,msgComposer.webfile_wrong_passwd2);return }if($("#_hint").val().length==0&&$("#_pwd_type").val()==2){$("#_hint").focus();$.modal.alert(msgComposer.alert,msgComposer.webfile_wrong_hint);return }if($("#_expire").val()==""){var B=new Date();var F=new Date();F.setFullYear($("#_year").val());F.setMonth(Number($("#_month").val())-1);F.setDate($("#_day").val());F.setHours($("#_hour").val());F.setMinutes($("#_min").val());if(Number(B.getTime()/1000+300)>Number(F.getTime()/1000)){$.modal.alert(msgComposer.alert,msgComposer.webfile_alert_reset_time);return }$("#mainform").find('input[name="year"]').val($("#_year").val());$("#mainform").find('input[name="month"]').val($("#_month").val());$("#mainform").find('input[name="day"]').val($("#_day").val());$("#mainform").find('input[name="hour"]').val($("#_hour").val());$("#mainform").find('input[name="min"]').val($("#_min").val())}$("#mainform").find('input[name="expire"]').val($("#_expire").val());$("#mainform").find('input[name="pwd"]').val($("#_pwd").val());$("#mainform").find('input[name="pwd_type"]').val($("#_pwd_type").val());$("#mainform").find('input[name="hint"]').val($("#_hint").val());$("#mainform").find('input[name="limit_download_cnt"]').val($("#_limit_download_cnt").val());var E="";var D="";var C="";var A="";$("#attachWebFileDiv > li").each(function(){$(this).attr("size");$(this).attr("key");$(this).attr("fname");E+=($(this).attr("size")+",");D+=($(this).attr("key")+",");C+=($(this).attr("fname")+"*");A+=(' <span class="roundDiv">'+$(this).attr("fname")+"</span> ")});$("#attachDiv").html(A.substr(0,A.length-3));$("#mainform").find('input[name="webfile_key"]').val(D.substr(0,D.length-1));$("#mainform").find('input[name="webfile_size"]').val(E.substr(0,E.length-1));$("#mainform").find('input[name="webfile_name"]').val(C.substr(0,C.length-1));$("#accessid").hide();$("#sendResultWrap").hide()}function CheckPasswd(D){var C=0;for(var A=0;A<D.length;++A){var B=D.substring(A,A+1);if(checkIsZenkaku(B)){return false}}return true}function checkIsZenkaku(B){for(var A=0;A<B.length;++A){var C=B.charCodeAt(A);if(C<256||(C>=65377&&C<=65439)){return false}}return true}function SendWebFileMail(){var A=$("#mainform");if(!ValidName(A.find('input[name="fromname"]').val())){A.find('input[name="fromname"]').focus();$.modal.alert(msgComposer.alert,msgComposer["65"]);return }if($("#tolist").children().size()==0){A.find('input[name="to"]').focus();$.modal.alert(msgComposer.alert,msgComposer.sc1);return }if(A.find('input[name="subject"]').val()==""&&!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.sc2,function(){SendWebFileMail()},function(){A.find('input[name="subject"]').focus()});return }InitRcpt("");A.find('input[name="mode"]').val("sendmail");A.attr("action","webfile_mailcreator.cgi");A.find('input[name="textbody"]').val("");A.find('input[name="textbody"]').val(deepEditor.getContent("text"));A.find('input[name="save"]').val($("#o-save").is(":checked")?"1":"0");A.find('input[name="disallowforward"]').val($("#o-disallowforward").is(":checked")?"1":"0");A.find('input[name="recived_confirm"]').val($("#o-recived_confirm").is(":checked")?"1":"0");A.find('input[name="msgtype"]').val("0");A.find('input[name="charset"]').val($("#charsetlist").val());A.find('input[name="prio"]').val($(":input:radio[name=priority]:checked").val());if(FROM_DISPLAY_ALIAS==2){if(ALIAS_ID==A.find('input[name="h_fromid"]').val()&&ALIAS_DOMAIN==A.find('input[name="h_fromdomain"]').val()){A.find('input[name="fromid"]').val(A.find('input[name="h_fromid"]').val());A.find('input[name="fromdomain"]').val(A.find('input[name="h_fromdomain"]').val())}}$("#sendResultWrap").width("100%");$("#sendResultWrap").height($(document).height());$("#sendResultWrap").show();$("#asvLoading").css("top",$("#sendBtn").offset().top-3);$("#asvLoading > .asvWrap > .asvMacro").html(msgComposer["2"]);$("#asvLoading").fadeIn();var B=A.serialize();$.post("webfile_mailcreator.cgi",B,function(D,E){$("#asvLoading").fadeOut();if(E=="success"){$("#sendResult").html(D);var C=($(window).width()-$("#sendResult").width())/2;if(C>0){$("#sendResult").css({"margin-left":C,"margin-right":C})}$("#sendResult").slideDown("fast");_TreeMenuRefresh()}else{$.modal.alert(msgComposer.error,msgComposer.sent_error);$("#sendResultWrap").hide()}}).fail(function(){$("#asvLoading").fadeOut();$.modal.alert(msgComposer.error,msgComposer.sent_error);$("#sendResultWrap").hide()})}function CancelWebFile(A){switch(A){case 0:$.modal.confirm(msgComposer.confirm,msgComposer.cancel_q,function(){CancelWebFile(1)},"");break;case 1:self.close();default:}}function Replace(E,B,C){var D="";for(var A=0;A<E.length;A++){if(A==0){D=E.replace(B,C)}else{D=D.replace(B,C)}}return D}function Registration(){if(g_bOnUpload==true){return }$("#asvLoading").css("top",$("#sendBtn").offset().top-3);$("#asvLoading > .asvWrap > .asvMacro").html(msgComposer["2"]);$("#asvLoading").fadeIn();var B=$("#mainform");if(B.find('input[name="to"]').val().trim()==""){$.modal.alert(msgComposer.alert,msgComposer.invalid_to);$("#asvLoading").fadeOut();return }var C=B.find('input[name="cc"]');var G=C.val().trim();if(G!=""){var A=G.length;var F=G.indexOf("@");var D=G.indexOf(".");if((F==-1)||(D==-1)||(D>=G-1)){C.focus();$.modal.alert(msgComposer.alert,msgComposer.invalid_cc);$("#asvLoading").fadeOut();return }B.find('input[name="scc"]').val(MLCreateRcpt("cc"))}var E=B.find('input[name="subject"]');if(E.val().trim()==""){if(!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.empty_subject,function(){Registration()},function(){$("#asvLoading").fadeOut();E.focus()});return }E.val(msgComposer.nosubject)}if(!MLSetParam("mailsend")){$("#asvLoading").fadeOut();return }B.find('input[name="sto"]').val(MLCreateRcpt("to"));B.find('input[name="msgtype"]').val(deepEditor.editorType=="html"?"2":"0");B.find('input[name="mode"]').val("mailsend");B.attr("action","mlsending.cgi");B.submit()}function Back(){if(!$.modal.isConfirm){$.modal.confirm(msgComposer.confirm,msgComposer.cancel_sending,function(){_Back()});return }}function MLSetParam(A){var B=$("#mainform");B.find('input[name="textbody"]').val(deepEditor.getContent("text"));if(deepEditor.editorType=="html"){B.find('input[name="body"]').val(deepEditor.getContent("html"))}B.find('input[name="charset"]').val($("#_charset").val());return true}function MLSetImportance(B){B.src=B.src.indexOf("low")>0?"../images/base/gen/icon_impor.gif":"../images/base/gen/icon_impor_low.gif";var C=B.src.indexOf("low")>0?0:1;var A=$("#mainform");A.find('input[name="prio"]').val(C)}function MLCreateRcpt(E){var B=document.mainform;var I=new Array();var H=new Array();Parse(H,B.elements[E].value);var C=0;for(i=0;i<H.length;i++){if(H[i].indexOf("@")==-1){B.isrcptcheck.value=1}H[i]=H[i].trim();if(H[i].charAt(0)=="["){var A=H[i].indexOf("]");if(A>-1){var G=H[i].substr(A+1);if(G.length>0){I[C++]='"'+H[i].substr(0,A+1)+'"'+G;continue}}else{I[C++]=H[i]+"]";continue}var J=B.elements.rcptgrp.length;var F=false;for(j=0;j<J;j++){var A=B.elements.rcptgrp.options[j].value.indexOf("]");var D=B.elements.rcptgrp.options[j].value.substring(0,A+1);if(B.elements.rcptgrp.options[j].text==E&&D==H[i]){F=true;I[C++]=B.elements.rcptgrp.options[j].value;B.elements.rcptgrp.options[j]=null;break}}if(!F){I[C++]=H[i]}}else{I[C++]=H[i]}}return I.join()};