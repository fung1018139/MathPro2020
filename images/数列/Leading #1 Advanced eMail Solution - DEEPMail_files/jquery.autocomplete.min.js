(function(B){var A=0;B.fn.extend({autocomplete:function(C,D){var E=typeof C=="string";D=B.extend({},B.Autocompleter.defaults,{url:E?C:null,data:E?null:C,delay:E?B.Autocompleter.defaults.delay:10,max:D&&!D.scroll?10:150},D);D.highlight=D.highlight||function(F){return F};D.formatMatch=D.formatMatch||D.formatItem;return this.each(function(){new B.Autocompleter(this,D)})},result:function(C){return this.bind("result",C)},search:function(C){return this.trigger("search",[C])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(C){return this.trigger("setOptions",[C])},unautocomplete:function(){return this.trigger("unautocomplete")}});B.Autocompleter=function(N,I){var D={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,KEYDOWN:229};var C=B(N).attr("autocomplete","off").addClass(I.inputClass);var L;var S="";var O=B.Autocompleter.Cache(I);var G=0;var W;var Z={mouseDownOnSelect:false};var T=B.Autocompleter.Select(I,N,E,Z);var Y;var a=window.navigator.userAgent.toLowerCase();a.indexOf("opera")>-1&&B(N.form).bind("submit.autocomplete",function(){if(Y){Y=false;return false}});C.bind("keydown.autocomplete",function(b){G=1;W=b.keyCode;switch(b.keyCode){case D.KEYDOWN:V(0,true);break;case D.UP:b.preventDefault();if(T.visible()){T.prev()}else{V(0,true)}break;case D.DOWN:b.preventDefault();if(T.visible()){T.next()}else{V(0,true)}break;case D.PAGEUP:b.preventDefault();if(T.visible()){T.pageUp()}else{V(0,true)}break;case D.PAGEDOWN:b.preventDefault();if(T.visible()){T.pageDown()}else{V(0,true)}break;case I.multiple&&B.trim(I.multipleSeparator)==","&&D.COMMA:case D.RETURN:if(E()){b.preventDefault();Y=true;if(I.additem){_AddRcptItem(C.attr("id"),C.val())}return false}else{V(0,true)}break;case D.ESC:T.hide();break;default:clearTimeout(L);L=setTimeout(V,I.delay);break}}).bind("keyup.autocomplete",function(b){switch(b.keyCode){case D.KEYDOWN:V(0,true);break;case I.multiple&&B.trim(I.multipleSeparator)==","&&D.COMMA:break;default:clearTimeout(L);L=setTimeout(V,I.delay);break}}).focus(function(){G++;if(this.setSelectionRange){}else{if(this.createTextRange){var b=this.createTextRange();b.moveStart("character",C.val().length);b.select()}}}).blur(function(){G=0;if(!Z.mouseDownOnSelect){U();_BlurRcpt(C.attr("id"))}}).click(function(){if(G++>1&&!T.visible()){V(0,true)}}).bind("search",function(){var b=(arguments.length>1)?arguments[1]:null;function c(g,f){var d;if(f&&f.length){for(var e=0;e<f.length;e++){if(f[e].result.toLowerCase()==g.toLowerCase()){d=f[e];break}}}if(typeof b=="function"){b(d)}else{C.trigger("result",d&&[d.data,d.value])}}B.each(J(C.val()),function(d,e){H(e,c,c)})}).bind("flushCache",function(){O.flush()}).bind("setOptions",function(){B.extend(I,arguments[1]);if("data" in arguments[1]){O.populate()}}).bind("unautocomplete",function(){T.unbind();C.unbind();B(N.form).unbind(".autocomplete")});function E(){var d=T.selected();if(!d){return false}var k=d.result;S=k;if(I.multiple){var g=J(C.val());var f=C.val().split(I.multipleSeparator);var j="";for(var e=0;e<f.length;e++){j+=B.trim(f[e]);if(e<f.length-1){j+=I.multipleSeparator}}C.val(j);if(g.length>1){var h=I.multipleSeparator.length;var l=B(N).selection().start;if(l<0){l=C.val().length}var c,b=0;B.each(g,function(m,n){b+=n.length;if(l<=b){c=m;return false}b+=h});g[c]=k;k=g.join(I.multipleSeparator)}k+=I.multipleSeparator}C.val(k);X();C.trigger("result",[d.data,d.value]);return true}function V(d,c){if(W==D.DEL){T.hide();return }var b=C.val();if(!c&&b==S){return }S=b;b=K(b);if(b.length>=I.minChars){C.addClass(I.loadingClass);if(!I.matchCase){b=b.toLowerCase()}H(b,M,X)}else{P();T.hide()}}function J(b){if(!b){return[""]}if(!I.multiple){return[B.trim(b)]}return B.map(b.split(I.multipleSeparator),function(c){return B.trim(b).length?B.trim(c):null})}function F(b){if(!b){return[""]}if(!I.multiple){return[B.trim(b)]}return B.map(b.split(I.multipleSeparator),function(c){return b.length?c:null})}function K(b){if(!I.multiple){return b}var c=F(b);if(c.length==1){return c[0]}c=F(b);return c[c.length-1]}function R(b,c){if(I.autoFill&&(K(C.val()).toLowerCase()==b.toLowerCase())&&W!=D.BACKSPACE){C.val(C.val()+c.substring(K(S).length));B(N).selection(S.length,S.length+c.length)}}function U(){clearTimeout(L);L=setTimeout(X,200)}function X(){var b=T.visible();T.hide();clearTimeout(L);P();if(I.mustMatch){C.search(function(c){if(!c){if(I.multiple){var d=J(C.val()).slice(0,-1);C.val(d.join(I.multipleSeparator)+(d.length?I.multipleSeparator:""))}else{C.val("");C.trigger("result",null)}}})}}function M(c,b){if(b&&b.length&&G){P();if(T.display(b,c)==0){X()}R(c,b[0].value);T.show()}else{X()}}function H(c,e,b){if(!I.matchCase){c=c.toLowerCase()}var d=O.load(c);if(d&&d.length){e(c,d)}else{if((typeof I.url=="string")&&(I.url.length>0)){var f={timestamp:+new Date()};B.each(I.extraParams,function(g,h){f[g]=typeof h=="function"?h():h});B.ajax({mode:"abort",port:"autocomplete"+N.name,dataType:I.dataType,url:I.url,data:B.extend({q:K(c),limit:I.max},f),success:function(h){var g=I.parse&&I.parse(h)||Q(h);O.add(c,g);e(c,g)}})}else{T.emptyList();b(c)}}}function Q(e){var b=[];var d=e.split("\n");for(var c=0;c<d.length;c++){var g=B.trim(d[c]);if(g){g=g.split("");var f=g[1].split("");if(f.length>1){if(f[1].indexOf(",")>-1||f[1].indexOf(";")>-1){g[2]='"'+f[1]+'" <'+f[0]+">"}else{g[2]=f[1]+" <"+f[0]+">"}}else{g[2]=f[0]}var f=g[2];g[2]=g[2].replace(/</g,"&lt;");g[2]=g[2].replace(/>/g,"&gt;");b[b.length]={data:g,value:g[1],result:I.formatResult&&I.formatResult(g,f)||f}}}return b}function P(){C.removeClass(I.loadingClass)}};B.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(C){return C[2]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:",",highlight:function(D,C){return D.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+C.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:false,scrollHeight:180};B.Autocompleter.Cache=function(D){var G={};var E=0;function I(L,K){if(!D.matchCase){L=L.toLowerCase()}var J=L.indexOf(K);if(D.matchContains=="word"){J=L.toLowerCase().search("\\b"+K.toLowerCase())}if(J==-1){return false}return J==0||D.matchContains}function H(K,J){if(E>D.cacheLength){C()}if(!G[K]){E++}G[K]=J}function F(){if(!D.data){return false}var K={},J=0;if(!D.url){D.cacheLength=1}K[""]=[];for(var M=0,L=D.data.length;M<L;M++){var P=D.data[M];P=(typeof P=="string")?[P]:P;var O=D.formatMatch(P,M+1,D.data.length);if(O===false){continue}var N=O.charAt(0).toLowerCase();if(!K[N]){K[N]=[]}var Q={value:O,data:P,result:D.formatResult&&D.formatResult(P)||O};K[N].push(Q);if(J++<D.max){K[""].push(Q)}}B.each(K,function(R,S){D.cacheLength++;H(R,S)})}setTimeout(F,25);function C(){G={};E=0}return{flush:C,add:H,populate:F,load:function(M){if(!D.cacheLength||!E){return null}if(!D.url&&D.matchContains){var L=[];for(var J in G){if(J.length>0){var N=G[J];B.each(N,function(P,O){if(I(O.value,M)){L.push(O)}})}}return L}else{if(G[M]){return G[M]}else{if(D.matchSubset){for(var K=M.length-1;K>=D.minChars;K--){var N=G[M.substr(0,K)];if(N){var L=[];B.each(N,function(P,O){if(I(O.value,M)){L[L.length]=O}});return L}}}}}return null}}};B.Autocompleter.Select=function(F,K,M,Q){var J={ACTIVE:"ac_over"};var L,G=-1,S,N="",T=true,D,P;function O(){if(!T){return }D=B("<div/>").hide().addClass(F.resultsClass).css("position","absolute").appendTo(document.body);P=B("<ul/>").appendTo(D).mouseover(function(U){if(R(U).nodeName&&R(U).nodeName.toUpperCase()=="LI"){G=B("li",P).removeClass(J.ACTIVE).index(R(U));B(R(U)).addClass(J.ACTIVE)}}).click(function(U){B(R(U)).addClass(J.ACTIVE);M();K.focus();if(F.additem){_AddRcptItem(K.getAttribute("id"),K.value)}return false}).mousedown(function(){Q.mouseDownOnSelect=true}).mouseup(function(){Q.mouseDownOnSelect=false});if(F.width>0){D.css("width",F.width)}T=false}function R(V){var U=V.target;while(U&&U.tagName!="LI"){U=U.parentNode}if(!U){return[]}return U}function I(U){L.slice(G,G+1).removeClass(J.ACTIVE);H(U);var W=L.slice(G,G+1).addClass(J.ACTIVE);if(A>0){if(F.scroll){var V=0;L.slice(0,G).each(function(){V+=this.offsetHeight});if((V+W[0].offsetHeight-P.scrollTop())>P[0].clientHeight){P.scrollTop(V+W[0].offsetHeight-P.innerHeight())}else{if(V<P.scrollTop()){P.scrollTop(V)}}}}}function H(U){G+=U;if(G<0){G=L.size()-1}else{if(G>=L.size()){G=0}}}function C(U){return F.max&&F.max<U?F.max:U}function E(){P.empty();A=0;var W=C(S.length);for(var Y=0;Y<S.length;Y++){if(!S[Y]){continue}var V=S[Y].value.split("");for(var X=0;X<V.length;X++){var a=V[X].substr(0,N.length);if(a.toLowerCase()!=N.toLowerCase()){continue}var Z=F.formatItem(S[Y].data,Y+1,W,V[X],N);if(Z===false){continue}A++;if(A>W){continue}var U=B("<li/>").html(F.highlight(Z,N)).addClass(Y%2==0?"ac_even":"ac_odd").appendTo(P)[0];B.data(U,"ac_data",S[Y]);break}}L=P.find("li");if(F.selectFirst){L.slice(0,1).addClass(J.ACTIVE);G=0}if(B.fn.bgiframe){P.bgiframe()}return A}return{display:function(V,U){O();S=V;N=U;return E()},next:function(){I(1)},prev:function(){I(-1)},pageUp:function(){if(G!=0&&G-8<0){I(-G)}else{I(-8)}},pageDown:function(){if(G!=L.size()-1&&G+8>L.size()){I(L.size()-1-G)}else{I(8)}},hide:function(){D&&D.hide();L&&L.removeClass(J.ACTIVE);G=-1},visible:function(){return D&&D.is(":visible")},current:function(){return this.visible()&&(L.filter("."+J.ACTIVE)[0]||F.selectFirst&&L[0])},show:function(){if(A>0){var Z=B(K).offset();var Y=F.width>0?F.width:B(K).width();if(Z.left+Y<B(document).width()){D.css({width:typeof F.width=="string"||F.width>0?F.width:B(K).width(),top:Z.top+K.offsetHeight+3,left:Z.left}).show()}else{var V=B(document).width()-Y-26;D.css({width:typeof F.width=="string"||F.width>0?F.width:B(K).width(),top:Z.top+K.offsetHeight+3,left:V}).show()}if(F.scroll){P.scrollTop(0);P.css({maxHeight:F.scrollHeight,overflow:"auto"});var U=0;L.each(function(){U+=this.offsetHeight});var X=window.navigator.userAgent.toLowerCase();var W=U>F.scrollHeight;P.css("height",W?F.scrollHeight:U);if(X.indexOf("trident")!=-1&&A>F.max){if(!W){L.width(P.width()-parseInt(L.css("padding-left"))-parseInt(L.css("padding-right")))}}}}},selected:function(){var U=L&&L.filter("."+J.ACTIVE).removeClass(J.ACTIVE);return U&&U.length&&B.data(U[0],"ac_data")},emptyList:function(){P&&P.empty()},unbind:function(){D&&D.remove()}}};B.fn.selection=function(J,C){if(J!==undefined){return this.each(function(){if(this.createTextRange){var K=this.createTextRange();if(C===undefined||J==C){K.move("character",J);K.select()}else{K.collapse(true);K.moveStart("character",J);K.moveEnd("character",C);K.select()}}else{if(this.setSelectionRange){this.focus();this.setSelectionRange(J,C)}else{if(this.selectionStart){this.selectionStart=J;this.selectionEnd=C}}}})}var H=this[0];if(H.createTextRange&&document.selection){var D=document.selection.createRange(),I=H.value,G="<->",E=D.text.length;D.text=G;var F=H.value.indexOf(G);H.value=I;this.selection(F,F+E);return{start:F,end:F+E}}else{if(H.setSelectionRange){this.selection(H.value.length,H.value.length);return{start:H.value.length,end:H.value.length}}else{if(H.selectionStart!==undefined){return{start:H.selectionStart,end:H.selectionEnd}}}}}})(jQuery);